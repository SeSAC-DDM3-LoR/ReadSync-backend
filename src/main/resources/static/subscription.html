<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì •ê¸° êµ¬ë… - ReadSync</title>
    <!-- Toss Payments SDK v1 (ë¹Œë§ìš©) -->
    <script src="https://js.tosspayments.com/v1/payment"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .nav-bar {
            display: flex;
            align-items: center;
            margin-bottom: 40px;
            gap: 20px;
        }

        .nav-bar a {
            color: #a0a0b0;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .nav-bar a:hover {
            color: #667eea;
        }

        .nav-bar h1 {
            font-size: 1.8rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .section h2 {
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #a0a0b0;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 14px 18px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #fff;
            font-size: 1rem;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: #fff;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .btn-full {
            width: 100%;
        }

        /* êµ¬ë… í”Œëœ ì¹´ë“œ */
        .plans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .plan-card {
            background: rgba(0, 0, 0, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .plan-card:hover {
            border-color: rgba(102, 126, 234, 0.5);
            transform: translateY(-5px);
        }

        .plan-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
        }

        .plan-card.popular {
            position: relative;
        }

        .plan-card.popular::before {
            content: 'ì¸ê¸°';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: #fff;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .plan-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .plan-name {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .plan-price {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .plan-period {
            color: #6a6a7a;
            margin-bottom: 20px;
        }

        .plan-features {
            list-style: none;
            text-align: left;
        }

        .plan-features li {
            padding: 8px 0;
            color: #a0a0b0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .plan-features li::before {
            content: 'âœ“';
            color: #22c55e;
            font-weight: bold;
        }

        /* ë‹¨ê³„ í‘œì‹œ */
        .steps {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 30px;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #6a6a7a;
        }

        .step.active {
            color: #667eea;
        }

        .step.completed {
            color: #22c55e;
        }

        .step-number {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .step.active .step-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
        }

        .step.completed .step-number {
            background: #22c55e;
            color: #fff;
        }

        .step-divider {
            width: 40px;
            height: 2px;
            background: rgba(255, 255, 255, 0.1);
            margin: 0 15px;
        }

        /* í˜„ì¬ êµ¬ë… ì •ë³´ */
        .subscription-info {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%);
            border-radius: 16px;
            padding: 25px;
        }

        .subscription-detail {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .subscription-detail:last-child {
            border-bottom: none;
        }

        .subscription-detail .label {
            color: #a0a0b0;
        }

        .subscription-detail .value {
            font-weight: 600;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .status-badge.active {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }

        .status-badge.cancelled {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        /* ë¡œê·¸ ì˜ì—­ */
        .log-area {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Fira Code', monospace;
            font-size: 0.85rem;
            line-height: 1.6;
        }

        .log-success {
            color: #22c55e;
        }

        .log-error {
            color: #ef4444;
        }

        .log-info {
            color: #a0a0b0;
        }

        /* ê²°ê³¼ ë°•ìŠ¤ */
        .result-box {
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 20px;
        }

        .result-box.success {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .result-box.error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="nav-bar">
            <a href="index.html">â† í™ˆìœ¼ë¡œ</a>
            <h1>ğŸ“… ì •ê¸° êµ¬ë…</h1>
        </div>

        <!-- ë‹¨ê³„ í‘œì‹œ -->
        <div class="steps">
            <div class="step" id="step1">
                <div class="step-number">1</div>
                <span>ì¹´ë“œ ë“±ë¡</span>
            </div>
            <div class="step-divider"></div>
            <div class="step" id="step2">
                <div class="step-number">2</div>
                <span>í”Œëœ ì„ íƒ</span>
            </div>
            <div class="step-divider"></div>
            <div class="step" id="step3">
                <div class="step-number">3</div>
                <span>êµ¬ë… ì™„ë£Œ</span>
            </div>
        </div>

        <!-- ì¹´ë“œ ë“±ë¡ ì„¹ì…˜ -->
        <div class="section" id="cardSection">
            <h2>ğŸ’³ ê²°ì œ ì¹´ë“œ ë“±ë¡</h2>
            <p style="color: #a0a0b0; margin-bottom: 25px;">
                ì •ê¸° ê²°ì œë¥¼ ìœ„í•´ ë¨¼ì € ì¹´ë“œë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”. ë“±ë¡ëœ ì¹´ë“œë¡œ ë§¤ì›” ìë™ ê²°ì œë©ë‹ˆë‹¤.
            </p>
            <div id="billingStatus" class="result-box" style="display: none;"></div>
            <button class="btn btn-primary btn-full" onclick="requestBillingAuth()">
                ğŸ” ì¹´ë“œ ë“±ë¡í•˜ê¸° (ë¹Œë§í‚¤ ë°œê¸‰)
            </button>
        </div>

        <!-- í”Œëœ ì„ íƒ ì„¹ì…˜ -->
        <div class="section" id="planSection">
            <h2>ğŸ“‹ êµ¬ë… í”Œëœ ì„ íƒ</h2>
            <div class="plans-grid">
                <div class="plan-card" data-plan="basic" data-price="4900">
                    <div class="plan-icon">ğŸ“š</div>
                    <div class="plan-name">Basic</div>
                    <div class="plan-price">â‚©4,900</div>
                    <div class="plan-period">/ ì›”</div>
                    <ul class="plan-features">
                        <li>ì›” 5ê¶Œ ë¬´ë£Œ ì—´ëŒ</li>
                        <li>ê¸°ë³¸ ë…ì„œ í†µê³„</li>
                        <li>ê´‘ê³  ì œê±°</li>
                    </ul>
                </div>

                <div class="plan-card popular" data-plan="premium" data-price="9900">
                    <div class="plan-icon">â­</div>
                    <div class="plan-name">Premium</div>
                    <div class="plan-price">â‚©9,900</div>
                    <div class="plan-period">/ ì›”</div>
                    <ul class="plan-features">
                        <li>ë¬´ì œí•œ ì—´ëŒ</li>
                        <li>ìƒì„¸ ë…ì„œ í†µê³„</li>
                        <li>ì˜¤í”„ë¼ì¸ ë‹¤ìš´ë¡œë“œ</li>
                        <li>ìš°ì„  ì§€ì›</li>
                    </ul>
                </div>

                <div class="plan-card" data-plan="family" data-price="14900">
                    <div class="plan-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</div>
                    <div class="plan-name">Family</div>
                    <div class="plan-price">â‚©14,900</div>
                    <div class="plan-period">/ ì›”</div>
                    <ul class="plan-features">
                        <li>5ëª…ê¹Œì§€ ì´ìš©</li>
                        <li>ë¬´ì œí•œ ì—´ëŒ</li>
                        <li>ê°€ì¡± ë…ì„œ í˜„í™©</li>
                        <li>ì•„ë™ ë³´í˜¸ ëª¨ë“œ</li>
                    </ul>
                </div>
            </div>

            <div class="form-group">
                <label>ì„ íƒí•œ í”Œëœ</label>
                <input type="text" id="selectedPlan" readonly placeholder="ìœ„ì—ì„œ í”Œëœì„ ì„ íƒí•´ì£¼ì„¸ìš”">
            </div>
            <div class="form-group">
                <label>ì›” ê²°ì œ ê¸ˆì•¡</label>
                <input type="number" id="selectedPrice" readonly>
            </div>

            <button class="btn btn-primary btn-full" onclick="subscribe()">
                ğŸš€ êµ¬ë… ì‹œì‘í•˜ê¸°
            </button>
        </div>

        <!-- í˜„ì¬ êµ¬ë… ì •ë³´ -->
        <div class="section" id="subscriptionSection">
            <h2>ğŸ“Š ë‚´ êµ¬ë… ì •ë³´</h2>
            <div id="subscriptionInfo" class="subscription-info">
                <p style="text-align: center; color: #6a6a7a; padding: 30px;">
                    êµ¬ë… ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                </p>
            </div>
            <div style="margin-top: 20px; text-align: center;">
                <button class="btn btn-secondary" onclick="loadSubscription()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            </div>
        </div>

        <!-- ë¡œê·¸ ì˜ì—­ -->
        <div class="section">
            <h2>ğŸ“ API ë¡œê·¸</h2>
            <div id="logArea" class="log-area">
                <div class="log-info">ëŒ€ê¸° ì¤‘...</div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        const API_BASE = '/api/v1';
        let selectedPlanName = '';
        let selectedPlanPrice = 0;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ
        window.onload = function () {
            setupPlanCards();
            updateSteps(1);
            loadSubscription();

            // URL íŒŒë¼ë¯¸í„° í™•ì¸ (ë¹Œë§í‚¤ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì²˜ë¦¬)
            processBillingRedirect();
        };

        // ì¸ì¦ í—¤ë”
        function getAuthHeader() {
            let token = localStorage.getItem('rs_jwt_token') || '';
            if (token && !token.startsWith('Bearer ')) {
                token = 'Bearer ' + token;
            }
            return {
                'Authorization': token,
                'Content-Type': 'application/json'
            };
        }

        // ë¡œê·¸ ì¶œë ¥
        function log(message, type = 'info') {
            const area = document.getElementById('logArea');
            const time = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'log-error' : type === 'success' ? 'log-success' : 'log-info';
            area.innerHTML = `<div class="${className}">[${time}] ${message}</div>` + area.innerHTML;
        }

        // ë‹¨ê³„ ì—…ë°ì´íŠ¸
        function updateSteps(currentStep) {
            for (let i = 1; i <= 3; i++) {
                const step = document.getElementById(`step${i}`);
                step.classList.remove('active', 'completed');
                if (i < currentStep) {
                    step.classList.add('completed');
                } else if (i === currentStep) {
                    step.classList.add('active');
                }
            }
        }

        // í”Œëœ ì¹´ë“œ ì„¤ì •
        function setupPlanCards() {
            const cards = document.querySelectorAll('.plan-card');
            cards.forEach(card => {
                card.addEventListener('click', () => {
                    cards.forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');

                    selectedPlanName = card.dataset.plan;
                    selectedPlanPrice = parseInt(card.dataset.price);

                    document.getElementById('selectedPlan').value = card.querySelector('.plan-name').textContent;
                    document.getElementById('selectedPrice').value = selectedPlanPrice;

                    log(`í”Œëœ ì„ íƒ: ${selectedPlanName} (â‚©${selectedPlanPrice.toLocaleString()}/ì›”)`);
                });
            });
        }

        // ë¹Œë§í‚¤ ë°œê¸‰ ìš”ì²­
        function requestBillingAuth() {
            // êµ¬ë… ê²°ì œìš© í´ë¼ì´ì–¸íŠ¸ í‚¤ (test_ck_ í˜•ì‹ - ë¹Œë§/ì •ê¸°ê²°ì œ ì „ìš©)
            // ë°±ì—”ë“œì˜ TOSS_SECRET_KEYì™€ ë§¤ì¹­ë˜ëŠ” í‚¤
            const clientKey = 'test_ck_eqRGgYO1r54g5P1wnlY5VQnN2Eya';

            log('ë¹Œë§í‚¤ ë°œê¸‰ ìš”ì²­ ì¤‘...');

            const tossPayments = TossPayments(clientKey);
            const customerKey = 'BILLING_' + Date.now();

            // ë¹Œë§ ì¸ì¦ ìš”ì²­
            tossPayments.requestBillingAuth('ì¹´ë“œ', {
                customerKey: customerKey,
                successUrl: window.location.origin + window.location.pathname,
                failUrl: window.location.origin + window.location.pathname
            }).catch(function (error) {
                log(`âŒ ë¹Œë§ ìš”ì²­ ì‹¤íŒ¨: ${error.message}`, 'error');
            });
        }

        // ë¹Œë§ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì²˜ë¦¬
        async function processBillingRedirect() {
            const urlParams = new URLSearchParams(window.location.search);

            // ë¹Œë§í‚¤ ë°œê¸‰ ì„±ê³µ
            if (urlParams.has('authKey') && urlParams.has('customerKey')) {
                log('ë¹Œë§ ì¸ì¦ ì„±ê³µ! ë°±ì—”ë“œ ë“±ë¡ ìš”ì²­ ì¤‘...');

                const billingData = {
                    authKey: urlParams.get('authKey'),
                    customerKey: urlParams.get('customerKey')
                };

                try {
                    const response = await fetch(`${API_BASE}/payments/billing-key`, {
                        method: 'POST',
                        headers: getAuthHeader(),
                        body: JSON.stringify(billingData)
                    });

                    if (response.ok) {
                        const statusBox = document.getElementById('billingStatus');
                        statusBox.style.display = 'block';
                        statusBox.className = 'result-box success';
                        statusBox.innerHTML = `
                            <h3 style="color: #22c55e;">âœ… ì¹´ë“œê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!</h3>
                            <p style="color: #a0a0b0;">ì´ì œ ì•„ë˜ì—ì„œ ì›í•˜ëŠ” í”Œëœì„ ì„ íƒí•˜ì„¸ìš”.</p>
                        `;

                        localStorage.setItem('rs_billing_registered', 'true');
                        updateSteps(2);
                        log('âœ… ë¹Œë§í‚¤ ë“±ë¡ ì™„ë£Œ!', 'success');
                    } else {
                        throw new Error('ë¹Œë§í‚¤ ë“±ë¡ ì‹¤íŒ¨');
                    }
                } catch (error) {
                    const statusBox = document.getElementById('billingStatus');
                    statusBox.style.display = 'block';
                    statusBox.className = 'result-box error';
                    statusBox.innerHTML = `<p style="color: #ef4444;">âŒ ${error.message}</p>`;
                    log(`âŒ ë¹Œë§í‚¤ ë“±ë¡ ì‹¤íŒ¨: ${error.message}`, 'error');
                }

                clearUrlParams();
            }

            // ë¹Œë§ ì‹¤íŒ¨
            else if (urlParams.has('code')) {
                const statusBox = document.getElementById('billingStatus');
                statusBox.style.display = 'block';
                statusBox.className = 'result-box error';
                statusBox.innerHTML = `
                    <p style="color: #ef4444;">âŒ ì¹´ë“œ ë“±ë¡ ì‹¤íŒ¨</p>
                    <p style="color: #6a6a7a;">${urlParams.get('message') || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}</p>
                `;
                log(`âŒ ë¹Œë§ ì‹¤íŒ¨: ${urlParams.get('message')}`, 'error');
                clearUrlParams();
            }

            // ì´ì „ì— ë“±ë¡í–ˆëŠ”ì§€ í™•ì¸
            else if (localStorage.getItem('rs_billing_registered') === 'true') {
                updateSteps(2);
                const statusBox = document.getElementById('billingStatus');
                statusBox.style.display = 'block';
                statusBox.className = 'result-box success';
                statusBox.innerHTML = `
                    <h3 style="color: #22c55e;">âœ… ì¹´ë“œê°€ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</h3>
                `;
            }
        }

        // êµ¬ë… ì‹œì‘
        async function subscribe() {
            if (!selectedPlanName || !selectedPlanPrice) {
                alert('êµ¬ë…í•  í”Œëœì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const billingRegistered = localStorage.getItem('rs_billing_registered');
            if (billingRegistered !== 'true') {
                alert('ë¨¼ì € ê²°ì œ ì¹´ë“œë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”.');
                return;
            }

            log(`êµ¬ë… ì‹œì‘ ìš”ì²­: ${selectedPlanName} (â‚©${selectedPlanPrice})`);

            try {
                const response = await fetch(`${API_BASE}/subscriptions?planName=${encodeURIComponent(selectedPlanName)}&price=${selectedPlanPrice}`, {
                    method: 'POST',
                    headers: getAuthHeader()
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || error.message || 'êµ¬ë… ì‹¤íŒ¨');
                }

                const data = await response.json();
                updateSteps(3);
                log(`âœ… êµ¬ë… ì™„ë£Œ: ${data.planName}`, 'success');
                alert('ğŸ‰ êµ¬ë…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                loadSubscription();

            } catch (error) {
                log(`âŒ êµ¬ë… ì‹¤íŒ¨: ${error.message}`, 'error');
                alert(`êµ¬ë… ì‹¤íŒ¨: ${error.message}`);
            }
        }

        // êµ¬ë… ì •ë³´ ì¡°íšŒ
        async function loadSubscription() {
            try {
                log('êµ¬ë… ì •ë³´ ì¡°íšŒ ì¤‘...');
                const response = await fetch(`${API_BASE}/subscriptions/me`, {
                    headers: getAuthHeader()
                });

                // 204 No Content: êµ¬ë… ì •ë³´ ì—†ìŒ
                if (response.status === 204) {
                    document.getElementById('subscriptionInfo').innerHTML = `
                        <p style="text-align: center; color: #6a6a7a; padding: 30px;">
                            ğŸ” í™œì„± êµ¬ë…ì´ ì—†ìŠµë‹ˆë‹¤.
                        </p>
                    `;
                    log('êµ¬ë… ì •ë³´ ì—†ìŒ (204)', 'info');
                    return;
                }

                if (!response.ok) {
                    throw new Error('êµ¬ë… ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨');
                }

                const data = await response.json();
                renderSubscription(data);
                log('âœ… êµ¬ë… ì •ë³´ ì¡°íšŒ ì™„ë£Œ', 'success');

            } catch (error) {
                document.getElementById('subscriptionInfo').innerHTML = `
                    <p style="text-align: center; color: #6a6a7a; padding: 30px;">
                        ğŸ” í™œì„± êµ¬ë…ì´ ì—†ìŠµë‹ˆë‹¤.
                    </p>
                `;
                log(`êµ¬ë… ì •ë³´ ì—†ìŒ: ${error.message}`, 'info');
            }
        }

        // êµ¬ë… ì •ë³´ ë Œë”ë§
        function renderSubscription(sub) {
            const statusClass = sub.status === 'ACTIVE' ? 'active' : 'cancelled';
            const statusText = sub.status === 'ACTIVE' ? 'ì´ìš© ì¤‘' : 'í•´ì§€ë¨';

            document.getElementById('subscriptionInfo').innerHTML = `
                <div class="subscription-detail">
                    <span class="label">í”Œëœ</span>
                    <span class="value">${sub.planName}</span>
                </div>
                <div class="subscription-detail">
                    <span class="label">ì›” ê²°ì œê¸ˆì•¡</span>
                    <span class="value" style="color: #667eea;">â‚©${sub.price.toLocaleString()}</span>
                </div>
                <div class="subscription-detail">
                    <span class="label">ì‹œì‘ì¼</span>
                    <span class="value">${sub.startedAt || '-'}</span>
                </div>
                <div class="subscription-detail">
                    <span class="label">ë‹¤ìŒ ê²°ì œì¼</span>
                    <span class="value">${sub.nextBillingDate || '-'}</span>
                </div>
                <div class="subscription-detail">
                    <span class="label">ìƒíƒœ</span>
                    <span class="status-badge ${statusClass}">${statusText}</span>
                </div>
                ${sub.status === 'ACTIVE' ? `
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn btn-danger" onclick="cancelSubscription(${sub.subId})">
                            êµ¬ë… í•´ì§€
                        </button>
                    </div>
                ` : ''}
            `;
        }

        // êµ¬ë… í•´ì§€
        async function cancelSubscription(subId) {
            if (!confirm('ì •ë§ êµ¬ë…ì„ í•´ì§€í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ë‹¤ìŒ ê²°ì œì¼ë¶€í„° ì²­êµ¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.')) {
                return;
            }

            try {
                log(`êµ¬ë… í•´ì§€ ìš”ì²­: ${subId}`);
                const response = await fetch(`${API_BASE}/subscriptions/${subId}`, {
                    method: 'DELETE',
                    headers: getAuthHeader()
                });

                if (!response.ok) {
                    throw new Error('í•´ì§€ ì‹¤íŒ¨');
                }

                log('âœ… êµ¬ë… í•´ì§€ ì™„ë£Œ', 'success');
                alert('êµ¬ë…ì´ í•´ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                loadSubscription();
            } catch (error) {
                log(`âŒ í•´ì§€ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        // URL íŒŒë¼ë¯¸í„° ì œê±°
        function clearUrlParams() {
            const newUrl = window.location.origin + window.location.pathname;
            window.history.replaceState({}, '', newUrl);
        }
    </script>
</body>

</html>