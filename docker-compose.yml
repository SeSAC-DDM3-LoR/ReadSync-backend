version: '3.8'

services:
  app:
    # ECR에 푸시한 이미지를 사용합니다.
    image: ${AWS_ACCOUNT_ID}.dkr.ecr.ap-northeast-2.amazonaws.com/readsync-backend:latest

    # EB(AL2/AL2023)는 기본적으로 80포트를 컨테이너로 전달하므로 80:8080 권장
    ports:
      - "80:8080"

    # EB 콘솔에서 설정할 환경 변수들을 매핑합니다.
    environment:
      - SPRING_PROFILES_ACTIVE=prod

      # [DB 연결] 실제 RDS 엔드포인트를 EB 환경 변수에 넣을 예정입니다.
      - RDS_ENDPOINT=${RDS_ENDPOINT}
      - RDS_DB_NAME=${RDS_DB_NAME}
      - RDS_USERNAME=${RDS_USERNAME}
      - RDS_PASSWORD=${RDS_PASSWORD}

      # [Valkey 연결] 사진에 있던 ElastiCache 엔드포인트를 넣을 예정입니다.
      - REDIS_HOST=${REDIS_HOST}
      - REDIS_PORT=${REDIS_PORT}

      # [AWS 및 기타]
      - AWS_ACCESS_KEY=${AWS_ACCESS_KEY}
      - AWS_SECRET_KEY=${AWS_SECRET_KEY}
      - S3_BUCKET_NAME=${S3_BUCKET_NAME}
      - JWT_SECRET=${JWT_SECRET}

      # 실제 도메인 또는 EB 주소
      - SERVER_URL=${SERVER_URL}

      # [OAuth2 - Google]
      - GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}
      - GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}

      # [OAuth2 - Kakao]
      - KAKAO_CLIENT_ID=${KAKAO_CLIENT_ID}
      - KAKAO_CLIENT_SECRET=${KAKAO_CLIENT_SECRET}

      # [OAuth2 - Naver]
      - NAVER_CLIENT_ID=${NAVER_CLIENT_ID}
      - NAVER_CLIENT_SECRET=${NAVER_CLIENT_SECRET}

      # 토스 관련 환경 변수 추가
      - TOSS_CLIENT_KEY=${TOSS_CLIENT_KEY}
      - TOSS_SECRET_KEY=${TOSS_SECRET_KEY}
      - TOSS_REGULAR_CLIENT_KEY=${TOSS_REGULAR_CLIENT_KEY}
      - TOSS_REGULAR_SECRET_KEY=${TOSS_REGULAR_SECRET_KEY}